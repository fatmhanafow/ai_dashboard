<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد اخبار هوش مصنوعی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 1200px;
        }
        .summary-loader {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #ccc;
            border-top-color: #333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .sentiment-positive { color: green; }
        .sentiment-neutral { color: gray; }
        .sentiment-negative { color: red; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

<div class="container mx-auto p-6 bg-white rounded-xl shadow-lg w-full">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">داشبورد اخبار هوش مصنوعی</h1>
        <p class="text-gray-600">جدیدترین و مهم‌ترین اخبار هوش مصنوعی از منابع معتبر</p>
    </header>

    <div id="loading" class="text-center text-gray-500 my-8">
        <div class="animate-spin rounded-full h-10 w-10 border-4 border-t-4 border-gray-900 border-opacity-50 mx-auto mb-4"></div>
        در حال بارگذاری...
    </div>

    <div id="source-list-container" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        <!-- لیست منابع خبری در اینجا قرار می‌گیرد -->
    </div>

    <div id="news-details-container" class="hidden">
        <button id="back-button" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-full mb-4 transition-colors duration-200">
            بازگشت به لیست منابع
        </button>
        <div class="flex justify-center mb-4">
            <button id="synthesize-button" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200">
                ✨ خلاصه کلی اخبار
            </button>
        </div>
        <div id="synthesis-result" class="bg-gray-100 p-4 rounded-lg shadow-inner hidden">
            <div id="synthesis-text" class="text-gray-700"></div>
        </div>
        <div id="news-container" class="grid gap-6">
            <!-- اخبار یک منبع خاص در اینجا قرار می‌گیرد -->
        </div>
    </div>

    <footer class="text-center text-sm text-gray-500 mt-8">
        <p>این داشبورد با استفاده از RSS Feed و جاوااسکریپت ساخته شده است.</p>
    </footer>
</div>

<script>
    // URL های CORS Proxy و RSS Feed
    const CORS_PROXY = "https://corsproxy.io/?";
    const sources = [
        { name: "The Decoder", url: "https://the-decoder.com/feed/" },
        { name: "OpenAI Blog", url: "https://openai.com/blog/rss/" },
        { name: "Anthropic Blog", url: "https://www.anthropic.com/rss" },
        { name: "r/OpenAI", url: "https://www.reddit.com/r/OpenAI/.rss" },
        { name: "r/LocalLLaMA", url: "https://www.reddit.com/r/LocalLLaMA/.rss" },
        { name: "Y Combinator", url: "https://news.ycombinator.com/rss" },
        { name: "Paul Graham", url: "https://www.paulgraham.com/rss.xml" }
    ];

    const allSummaries = [];
    let isSynthesizing = false;

    // تابع برای ایجاد خلاصه ۳ خطی با استفاده از Gemini API
    async function generateSummary(text) {
        const prompt = `متن زیر را در سه خط خلاصه کن:\n\n${text}`;
        const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=';
        const apiKey = ""; 

        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            systemInstruction: {
                parts: [{ text: 'شما یک دستیار خلاصه ساز خبر هستید. تنها یک خلاصه سه خطی از متن ورودی ارائه دهید.' }]
            },
        };

        try {
            const response = await fetch(apiUrl + apiKey, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            const summary = result?.candidates?.[0]?.content?.parts?.[0]?.text;
            return summary || 'خلاصه در دسترس نیست.';
        } catch (error) {
            console.error('Error generating summary:', error);
            return 'خلاصه در دسترس نیست.';
        }
    }

    // تابع برای تحلیل احساسات با استفاده از Gemini API
    async function analyzeSentiment(text, elementId) {
        const sentimentElement = document.getElementById(elementId);
        sentimentElement.innerHTML = `<span class="summary-loader"></span>`;
        const prompt = `احساسات متن زیر را به صورت یکی از کلمات 'مثبت', 'خنثی', یا 'منفی' تحلیل کن:\n\n${text}`;
        const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=';
        const apiKey = ""; 

        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            systemInstruction: {
                parts: [{ text: 'شما یک تحلیلگر احساسات هستید. تنها یک کلمه از کلمات "مثبت", "خنثی", یا "منفی" را برگردانید.' }]
            },
        };

        try {
            const response = await fetch(apiUrl + apiKey, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            let sentiment = result?.candidates?.[0]?.content?.parts?.[0]?.text.trim();
            if (sentiment === 'مثبت') {
                sentimentElement.innerHTML = '<span class="sentiment-positive">احساسات: مثبت</span>';
            } else if (sentiment === 'منفی') {
                sentimentElement.innerHTML = '<span class="sentiment-negative">احساسات: منفی</span>';
            } else {
                sentimentElement.innerHTML = '<span class="sentiment-neutral">احساسات: خنثی</span>';
            }
        } catch (error) {
            console.error('Error analyzing sentiment:', error);
            sentimentElement.innerHTML = 'خطا در تحلیل احساسات.';
        }
    }

    // تابع برای ترکیب خلاصه کل اخبار
    async function synthesizeAllSummaries() {
        if (isSynthesizing) return;
        isSynthesizing = true;
        
        const synthesisResultDiv = document.getElementById('synthesis-result');
        const synthesisTextDiv = document.getElementById('synthesis-text');
        synthesisResultDiv.classList.remove('hidden');
        synthesisTextDiv.innerHTML = `<div class="text-center my-4"><span class="summary-loader"></span> در حال ترکیب خلاصه اخبار...</div>`;
        
        const allText = allSummaries.join('\n\n');
        const prompt = `خلاصه اخبار زیر را با هم ترکیب کن و یک پاراگراف جامع ارائه بده:\n\n${allText}`;
        const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=';
        const apiKey = ""; 

        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            systemInstruction: {
                parts: [{ text: 'شما یک دستیار هوشمند خبر هستید. یک خلاصه کلی از تمام خبرها ارائه دهید.' }]
            },
        };

        try {
            const response = await fetch(apiUrl + apiKey, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            const synthesis = result?.candidates?.[0]?.content?.parts?.[0]?.text;
            synthesisTextDiv.textContent = synthesis || 'خطا در ترکیب خلاصه ها.';
        } catch (error) {
            console.error('Error synthesizing summaries:', error);
            synthesisTextDiv.textContent = 'خطا در ترکیب خلاصه ها.';
        } finally {
            isSynthesizing = false;
        }
    }

    // تابع برای دریافت و نمایش اخبار یک منبع
    async function fetchAndDisplaySourceNews(source) {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('source-list-container').classList.add('hidden');
        document.getElementById('news-details-container').classList.remove('hidden');
        const newsContainer = document.getElementById('news-container');
        newsContainer.innerHTML = '';
        allSummaries.length = 0; // Clear previous summaries
        document.getElementById('synthesis-result').classList.add('hidden');

        try {
            const response = await fetch(CORS_PROXY + encodeURIComponent(source.url));
            const data = await response.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data, "text/xml");
            
            const items = xmlDoc.querySelectorAll("item, entry");
            
            let allNewsItems = [];
            items.forEach(item => {
                const titleElement = item.querySelector("title");
                const linkElement = item.querySelector("link");
                const descriptionElement = item.querySelector("description, summary");
                const pubDateElement = item.querySelector("pubDate, updated");
                
                if (titleElement && linkElement && descriptionElement && pubDateElement) {
                    const title = titleElement.textContent;
                    const link = linkElement.textContent;
                    const description = descriptionElement.textContent;
                    const pubDate = new Date(pubDateElement.textContent);
                    
                    allNewsItems.push({
                        title,
                        link,
                        description,
                        pubDate,
                    });
                }
            });

            allNewsItems.sort((a, b) => b.pubDate - a.pubDate);
            const top3News = allNewsItems.slice(0, 3);
            
            document.getElementById('loading').style.display = 'none';

            if (top3News.length === 0) {
                newsContainer.innerHTML = `<p class="text-center text-gray-500">هیچ خبری برای نمایش از ${source.name} وجود ندارد.</p>`;
                return;
            }

            for (let i = 0; i < top3News.length; i++) {
                const newsItem = top3News[i];
                const card = document.createElement('div');
                card.classList.add('bg-white', 'p-6', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200', 'hover:shadow-xl', 'transition-shadow', 'duration-300');
                
                const sentimentId = `sentiment-${i}`;
                const summaryId = `summary-${i}`;

                card.innerHTML = `
                    <h3 class="text-xl font-semibold mb-2">
                        <a href="${newsItem.link}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 transition-colors duration-200">
                            ${newsItem.title}
                        </a>
                    </h3>
                    <p class="text-gray-500 text-sm mt-1">
                        <span id="${summaryId}" class="summary-text"><span class="summary-loader"></span> در حال خلاصه سازی...</span>
                    </p>
                    <div class="mt-4 flex items-center justify-between">
                        <button class="get-sentiment-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-1 px-3 rounded-full text-xs transition-colors duration-200" data-index="${i}">
                            ✨ دریافت حس خبر
                        </button>
                        <span id="${sentimentId}" class="text-sm font-semibold"></span>
                    </div>
                `;
                newsContainer.appendChild(card);
                
                // Generate and display summary asynchronously
                generateSummary(newsItem.description).then(summary => {
                    const summaryElement = document.getElementById(summaryId);
                    if (summaryElement) {
                        summaryElement.textContent = summary;
                        allSummaries[i] = summary;
                    }
                });
            }

            // Add event listeners for sentiment buttons
            document.querySelectorAll('.get-sentiment-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const index = event.target.dataset.index;
                    analyzeSentiment(top3News[index].description, `sentiment-${index}`);
                });
            });

        } catch (error) {
            console.error(`خطا در دریافت خبر از ${source.name}:`, error);
            document.getElementById('loading').style.display = 'none';
            newsContainer.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-md border border-red-400"><h2 class="text-2xl font-bold text-red-700 mb-4">${source.name}</h2><p class="text-red-500">متاسفانه امکان دریافت خبر وجود ندارد. شاید آدرس RSS تغییر کرده است.</p></div>`;
        }
    }

    // تابع برای رندر لیست منابع
    function renderSourceList() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('source-list-container').classList.remove('hidden');
        document.getElementById('news-details-container').classList.add('hidden');
        const sourceListContainer = document.getElementById('source-list-container');
        sourceListContainer.innerHTML = '';

        sources.forEach(source => {
            const card = document.createElement('div');
            card.classList.add('bg-white', 'p-6', 'rounded-lg', 'shadow-md', 'border', 'border-gray-200', 'hover:shadow-xl', 'transition-shadow', 'duration-300', 'cursor-pointer', 'flex', 'flex-col', 'items-center', 'justify-center');
            card.innerHTML = `<h2 class="text-2xl font-bold text-gray-800 text-center">${source.name}</h2>`;
            card.addEventListener('click', () => fetchAndDisplaySourceNews(source));
            sourceListContainer.appendChild(card);
        });
    }

    // Add event listener for the back button
    document.getElementById('back-button').addEventListener('click', renderSourceList);

    // Add event listener for the synthesize button
    document.getElementById('synthesize-button').addEventListener('click', synthesizeAllSummaries);

    // Run the function when the page loads
    document.addEventListener('DOMContentLoaded', renderSourceList);

</script>

</body>
</html>
